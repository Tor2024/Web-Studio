(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{278:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var n=a(5155),r=a(2115);function l(e){let{items:t,onEdit:a,onDelete:r,onCreate:l,type:s}=e;return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto mb-10",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"news"===s?"Новости":"Портфолио"}),(0,n.jsx)("button",{onClick:l,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"Добавить"})]}),t&&0!==t.length?(0,n.jsx)("div",{className:"grid gap-4",children:t.map(e=>{var t,l;return(0,n.jsxs)("div",{className:"border p-4 rounded-xl bg-white flex gap-4 items-center shadow",children:[e.cover&&(0,n.jsx)("img",{src:e.cover,alt:"cover",className:"w-16 h-16 object-cover rounded"}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"font-semibold",children:(null==(t=e.title)?void 0:t.ru)||(null==(l=e.title)?void 0:l.en)||"(без названия)"}),(0,n.jsx)("div",{className:"text-gray-500 text-sm",children:e.date})]}),(0,n.jsx)("button",{onClick:()=>a(e),className:"px-3 py-1 bg-green-500 text-white rounded mr-2 hover:bg-green-600",children:"Редактировать"}),(0,n.jsx)("button",{onClick:()=>r(e.folder_name),className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Удалить"})]},e.folder_name)})}):(0,n.jsx)("div",{className:"text-gray-500 text-center py-10",children:"Публикаций пока нет"})]})}function s(){let[e,t]=r.useState(!1);return[r.useCallback(async e=>{try{let a;if(t(!0),"file"in e&&e.file){let t=new FormData;t.append("file",e.file),a=await fetch("/api/uploads/",{method:"POST",body:t})}else a="url"in e?await fetch("/_create/api/upload/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e.url})}):"base64"in e?await fetch("/_create/api/upload/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({base64:e.base64})}):await fetch("/_create/api/upload/",{method:"POST",headers:{"Content-Type":"application/octet-stream"},body:e.buffer});if(!a.ok){if(413===a.status)throw Error("Upload failed: File too large.");throw Error("Upload failed")}let n=await a.json();return{url:n.url,mimeType:n.mimeType||null}}catch(e){if(console.error("Upload error:",e),e instanceof Error)return{error:e.message};if("string"==typeof e)return{error:e};return{error:"Upload failed"}}finally{t(!1)}},[]),{loading:e}]}function i(e){let{value:t,onChange:a}=e,l=(0,r.useRef)(),[i]=s(),o=(0,r.useRef)(),[c,d]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(l.current&&t!==o.current){l.current.innerHTML=t||"",o.current=t;let e=document.createRange();e.selectNodeContents(l.current),e.collapse(!1);let a=window.getSelection();a.removeAllRanges(),a.addRange(e)}},[t]),(0,r.useEffect)(()=>{if(!t)return void d([]);let e=document.createElement("div");e.innerHTML=t,d(Array.from(e.querySelectorAll("img")).map(e=>e.src).filter(e=>e.startsWith("data:")))},[t]);let u=async()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.multiple=!0,e.onchange=async e=>{let t=Array.from(e.target.files);if(t.length>0){let e=[];for(let a of t){let t=new FileReader;await new Promise(n=>{t.onload=t=>{e.push(t.target.result),n()},t.readAsDataURL(a)})}d(t=>[...t,...e])}},e.click()},m=(0,r.useCallback)(e=>{if(d(t=>t.filter(t=>t!==e)),l.current){let t=l.current.innerHTML.replace(RegExp('<img[^>]*src="'.concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),'"[^>]*>'),"g"),"");l.current.innerHTML=t,a(t)}},[a]),h=(0,r.useCallback)(e=>{let t=l.current;if(!t)return;t.focus();let n=window.getSelection();if(!n.rangeCount)return;let r=n.getRangeAt(0);r.deleteContents();let s=document.createElement("img");s.src=e,s.alt="Uploaded Image",s.style.width="100%",s.style.height="auto",r.insertNode(s),r.setStartAfter(s),r.setEndAfter(s),n.removeAllRanges(),n.addRange(r),setTimeout(()=>{t&&a(t.innerHTML)},0)},[a]);return(0,r.useCallback)(e=>{let t=l.current;if(!t)return;t.focus();let n=window.getSelection();if(!n.rangeCount)return;let r=n.getRangeAt(0);r.deleteContents();let s=document.createElement("div");s.innerHTML=e;let i=document.createDocumentFragment();for(;s.firstChild;)i.appendChild(s.firstChild);r.insertNode(i),r.setStartAfter(i.lastChild||i),r.setEndAfter(i.lastChild||i),n.removeAllRanges(),n.addRange(r),setTimeout(()=>{t&&a(t.innerHTML)},0)},[a]),(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{type:"button",onClick:u,className:"mb-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Загрузить изображения"}),c.length>0&&(0,n.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded border",children:[(0,n.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Кликните на изображение, чтобы вставить в текст:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:c.map((e,t)=>(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("img",{src:e,alt:"Image ".concat(t+1),className:"w-16 h-16 object-cover rounded border cursor-pointer hover:border-blue-500 hover:shadow-md transition-all",onClick:()=>h(e),title:"Кликните, чтобы вставить в текст"}),(0,n.jsx)("button",{type:"button",className:"absolute top-0 right-0 bg-red-500 text-white rounded-full w-4 h-4 text-xs flex items-center justify-center hover:bg-red-600",onClick:()=>m(e),title:"Удалить изображение",children:"\xd7"})]},t))})]}),(0,n.jsx)("div",{ref:l,contentEditable:!0,className:"border rounded px-2 py-1 min-h-[120px] bg-white focus:outline-[#A8D5BA]",onKeyUp:e=>a(e.currentTarget.innerHTML),suppressContentEditableWarning:!0,dir:"ltr",lang:"ru",style:{whiteSpace:"pre-wrap",textAlign:"left"}})]})}let o=["en","ru","de"];function c(e){let{initialData:t,onSave:a,type:l}=e;t=t||{};let[c,d]=(0,r.useState)(t.cover||""),[u,m]=(0,r.useState)(null),[h,p]=(0,r.useState)(t.title||{en:"",ru:"",de:""}),[f,g]=(0,r.useState)(t.content||{en:"",ru:"",de:""}),[b,x]=(0,r.useState)(t.date||new Date().toISOString().substring(0,10)),[y,v]=(0,r.useState)("en"),[w,j]=(0,r.useState)(!1),[N,C]=(0,r.useState)(""),[S,T]=(0,r.useState)(""),k=t.folder_name||null,[E]=s();(0,r.useRef)();let A=(f[y].match(/<img /g)||[]).length;async function R(e){let t=e.target.files[0];if(m(t),t){let e=new FileReader;e.onload=e=>{d(e.target.result)},e.readAsDataURL(t)}}async function _(e){if(e.preventDefault(),!h.en||!h.ru||!h.de)return void T("Заполните все поля названий на трёх языках");if(!Object.values(f).some(e=>e.trim().length>0))return void T("Добавьте хотя бы один текст публикации");j(!0);let n=c||t.cover||"",r=k;if(!k){let e=new Date().toISOString().replace(/[-:TZ.]/g,"").slice(0,14);r="".concat(l,"_").concat(e)}let s={folder_name:r,cover:n,title:h,content:f,date:b};await a(s),j(!1)}return(0,n.jsxs)("form",{onSubmit:_,className:"space-y-6 max-w-xl mx-auto p-6 bg-white rounded-xl shadow",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"font-semibold block mb-1",children:"Дата"}),(0,n.jsx)("input",{type:"date",className:"w-full border p-2 rounded",value:b,onChange:e=>x(e.target.value)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"font-semibold block mb-1",children:"Обложка"}),(0,n.jsx)("input",{type:"file",accept:"image/*",onChange:R}),c&&(0,n.jsx)("img",{src:c,alt:"cover preview",className:"mt-2 max-w-xs rounded"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex gap-2 mb-2",children:o.map(e=>(0,n.jsx)("button",{type:"button",onClick:()=>v(e),className:"px-3 py-1 rounded ".concat(y===e?"bg-blue-500 text-white":"bg-gray-100 text-blue-900"),children:e.toUpperCase()},e))}),(0,n.jsx)("label",{className:"font-semibold block mb-1",children:"Название публикации"}),(0,n.jsx)("input",{className:"w-full border p-2 rounded mb-4",value:h[y],onChange:e=>p(t=>({...t,[y]:e.target.value}))}),(0,n.jsxs)("label",{className:"font-semibold block mb-1",children:["Текст публикации (",A,"/5 изображений)"]}),(0,n.jsx)(i,{value:f[y],onChange:e=>{(e.match(/<img /g)||[]).length<=5&&g(t=>({...t,[y]:e}))}}),(0,n.jsx)("div",{className:"text-gray-500 text-sm mt-1",children:"Можно вставить не более 5 изображений в текст на каждом языке"})]}),S&&(0,n.jsx)("div",{className:"text-red-600",children:S}),(0,n.jsx)("button",{type:"submit",className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg shadow",disabled:w,children:w?"Сохраняем...":"Сохранить"})]})}function d(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(null),[i,o]=(0,r.useState)("news");(0,r.useEffect)(()=>{d()},[i]);let d=async()=>{let e=await fetch("/api/".concat(i));t((await e.json()).data||[])},u=async e=>{confirm("Удалить?")&&(await fetch("/api/".concat(i),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({folder_name:e})}),d())},m=async e=>{let t=e.folder_name?"PUT":"POST";await fetch("/api/".concat(i),{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s(null),d()};return a?(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,n.jsx)(c,{item:a,onSave:m,onCancel:()=>s(null)})}):(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Админ панель"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("button",{onClick:()=>o("news"),className:"px-4 py-2 mr-2 rounded ".concat("news"===i?"bg-blue-600 text-white":"bg-gray-200"),children:"Новости"}),(0,n.jsx)("button",{onClick:()=>o("portfolio"),className:"px-4 py-2 rounded ".concat("portfolio"===i?"bg-blue-600 text-white":"bg-gray-200"),children:"Портфолио"})]}),(0,n.jsx)(l,{items:e,onEdit:e=>{s({...e,type:i})},onDelete:u,onCreate:()=>{s({type:i})},type:i})]})}},2177:(e,t,a)=>{Promise.resolve().then(a.bind(a,278))}},e=>{e.O(0,[441,255,358],()=>e(e.s=2177)),_N_E=e.O()}]);